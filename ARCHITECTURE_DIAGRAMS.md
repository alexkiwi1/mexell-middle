# Frigate Middleware API - Architecture Diagrams

## 🏗️ System Architecture Overview

### High-Level System Architecture
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           FRIGATE MIDDLEWARE API                                │
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐            │
│  │   Web Dashboard │    │   Mobile App    │    │   API Clients   │            │
│  │   (Frontend)    │    │   (React Native)│    │   (External)    │            │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘            │
│           │                       │                       │                   │
│           └───────────────────────┼───────────────────────┘                   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐  │
│  │                    EXPRESS.JS MIDDLEWARE API                            │  │
│  │                                                                         │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │  │
│  │  │   REST API  │  │  WebSocket  │  │  Auth/JWT   │  │  Rate Limit │   │  │
│  │  │   Endpoints │  │   Server    │  │   Security  │  │   Control   │   │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │  │
│  │                                                                         │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │  │
│  │  │  Employee   │  │  Violation │  │   Camera    │  │  Analytics  │   │  │
│  │  │  Tracking   │  │  Detection │  │ Management  │  │   Service   │   │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │  │
│  └─────────────────────────────────────────────────────────────────────────┘  │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐  │
│  │                        DATABASE LAYER                                  │  │
│  │                                                                         │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │  │
│  │  │ PostgreSQL  │  │ PostgreSQL  │  │   MongoDB   │  │    Redis    │   │  │
│  │  │  (Frigate)  │  │   (App)     │  │ (Desk Mgmt)│  │  (Cache)    │   │  │
│  │  │ Read-Only   │  │ Read-Write  │  │ User Data   │  │ Session     │   │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │  │
│  └─────────────────────────────────────────────────────────────────────────┘  │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐  │
│  │                      FRIGATE INTEGRATION                              │  │
│  │                                                                         │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │  │
│  │  │   Frigate   │  │   Video     │  │  Security   │                    │  │
│  │  │   Server    │  │   Server    │  │  Cameras    │                    │  │
│  │  │   (AI)      │  │  (Media)    │  │ (Hardware)  │                    │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                    │  │
│  └─────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 Data Flow Architecture

### Real-time Data Processing Flow
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           DATA PROCESSING PIPELINE                             │
│                                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │  Security   │───▶│   Frigate    │───▶│  Detection  │───▶│  Face       │     │
│  │  Cameras    │    │   AI Server  │    │ Processing  │    │ Recognition │     │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
│                                                              │                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │  Violation  │◀───│  Business   │◀───│  Data       │◀───│  Timeline   │     │
│  │  Detection  │    │   Logic     │    │ Ingestion   │    │  Events     │     │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                   │                   │                   │         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │  Real-time  │    │   API       │    │   Cache     │    │  Database   │     │
│  │  Streaming  │    │ Responses   │    │  Layer      │    │  Storage    │     │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔒 Security Architecture

### Multi-Layer Security Implementation
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           SECURITY LAYERS                                      │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        CLIENT LAYER                                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │   HTTPS     │  │   CORS       │  │   Origin     │  │   Headers    │  │   │
│  │  │ Encryption  │  │ Protection  │  │ Validation  │  │ Validation  │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      MIDDLEWARE LAYER                                  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │   Helmet    │  │   Rate      │  │   Input     │  │   XSS        │  │   │
│  │  │   Security  │  │  Limiting   │  │ Validation  │  │ Protection  │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      AUTHENTICATION LAYER                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │   JWT       │  │   Passport   │  │   Role       │  │   Token     │  │   │
│  │  │   Tokens    │  │   Strategy  │  │   Based      │  │ Management  │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        DATABASE LAYER                                  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │   SQL       │  │   NoSQL     │  │   Cache     │  │   Session   │  │   │
│  │  │ Injection   │  │ Injection  │  │ Security   │  │ Management │  │   │
│  │  │ Protection  │  │ Protection │  │            │  │            │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 📊 Database Architecture

### Multi-Database Design
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           DATABASE ARCHITECTURE                                │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    POSTGRESQL (FRIGATE) - READ ONLY                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │  Timeline   │  │ Recordings  │  │   Events    │  │    Faces    │   │   │
│  │  │  (Events)   │  │ (Videos)    │  │ (Frigate)   │  │ (Recognition)│   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    POSTGRESQL (APP) - READ/WRITE                      │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Reports   │  │    Cache    │  │   Sessions  │  │   Metrics   │   │   │
│  │  │ (Generated) │  │ (Performance)│  │ (User)     │  │ (Analytics) │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        MONGODB - DOCUMENT STORE                      │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Users     │  │   Tokens    │  │   Desk      │  │   Settings  │   │   │
│  │  │ (Accounts)  │  │ (Auth)      │  │Assignments  │  │ (Config)    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        REDIS - CACHE LAYER                            │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Session   │  │   API       │  │   WebSocket │  │   Real-time │   │   │
│  │  │   Cache     │  │   Cache     │  │   Cache     │  │   Data      │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🌐 API Architecture

### RESTful API Structure
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              API ARCHITECTURE                                  │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           API GATEWAY                                  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Rate      │  │   Auth      │  │   CORS      │  │   Logging   │   │   │
│  │  │  Limiting   │  │   JWT      │  │   Headers   │  │   Morgan    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        API ROUTES (v1)                                │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Health    │  │    Auth     │  │   Users     │  │   Mobile    │   │   │
│  │  │   Check     │  │  Endpoints  │  │ Management │  │   APIs      │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │  Employees  │  │ Violations │  │   Cameras   │  │  Analytics  │   │   │
│  │  │  Tracking   │  │ Detection  │  │ Management  │  │   Service   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │    Zones    │  │   Reports   │  │ Performance │  │  WebSocket  │   │   │
│  │  │ Management  │  │ Generation  │  │ Monitoring  │  │   Events    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        SERVICE LAYER                                  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │  Business   │  │   Data      │  │   Cache     │  │   External  │   │   │
│  │  │   Logic     │  │ Processing  │  │ Management  │  │   APIs      │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 WebSocket Architecture

### Real-time Communication Flow
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        WEBSOCKET ARCHITECTURE                                   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        CLIENT CONNECTIONS                              │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Web       │  │   Mobile    │  │   Desktop   │  │   External  │   │   │
│  │  │  Browser    │  │    App      │  │   Client    │  │   Service   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      SOCKET.IO SERVER                                 │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ Connection  │  │ Subscription│  │   Event     │  │   Message   │   │   │
│  │  │ Management  │  │ Management  │  │ Broadcasting │  │   Routing   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        EVENT TYPES                                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ Violation  │  │ Employee    │  │ Camera      │  │ Zone        │   │   │
│  │  │ Detected   │  │ Activity    │  │ Status      │  │ Occupancy   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        DATA SOURCES                                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ Frigate     │  │ Database    │  │ Cache       │  │ External    │   │   │
│  │  │ Events      │  │ Changes     │  │ Updates     │  │ APIs        │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 📈 Performance Architecture

### Caching and Optimization Strategy
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        PERFORMANCE ARCHITECTURE                                │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        CACHE LAYERS                                    │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   L1 Cache  │  │   L2 Cache  │  │   L3 Cache  │  │   CDN       │   │   │
│  │  │ (Memory)    │  │ (Redis)     │  │ (Database)  │  │ (Static)    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      OPTIMIZATION STRATEGIES                           │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ Connection  │  │ Query       │  │ Response    │  │ Resource    │   │   │
│  │  │ Pooling     │  │ Optimization│  │ Compression │  │ Management  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        MONITORING                                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ Performance │  │ Memory      │  │ Database    │  │ Network     │   │   │
│  │  │ Metrics     │  │ Usage       │  │ Performance │  │ Latency     │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🚀 Deployment Architecture

### Container and Infrastructure
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        DEPLOYMENT ARCHITECTURE                                 │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        LOAD BALANCER                                   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Nginx     │  │   HAProxy    │  │   Cloud     │  │   Custom    │   │   │
│  │  │   Reverse   │  │   Load       │  │   Load      │  │   Load      │   │   │
│  │  │   Proxy     │  │   Balancer   │  │   Balancer  │  │   Balancer  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        APPLICATION LAYER                               │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Node.js   │  │   Node.js   │  │   Node.js   │  │   Node.js   │   │   │
│  │  │   Instance  │  │   Instance  │  │   Instance  │  │   Instance  │   │   │
│  │  │     1       │  │     2       │  │     3       │  │     4       │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        DATABASE LAYER                                 │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │ PostgreSQL  │  │ PostgreSQL  │  │   MongoDB    │  │    Redis     │   │   │
│  │  │ (Frigate)   │  │   (App)     │  │ (Replica)   │  │ (Cluster)    │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                   │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        INFRASTRUCTURE                                 │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │   Docker    │  │ Kubernetes  │  │   Cloud     │  │   On-Prem   │   │   │
│  │  │ Containers  │  │   Cluster   │  │   Services  │  │   Servers   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 📊 Component Interaction Diagram

### Service Communication Flow
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        COMPONENT INTERACTIONS                                  │
│                                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   Client   │───▶│   Express   │───▶│ Controller  │───▶│   Service   │     │
│  │  Request   │    │   Router    │    │   Layer     │    │   Layer     │     │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                   │                   │                   │         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   Client   │◀───│   Express   │◀───│ Controller  │◀───│   Service   │     │
│  │ Response   │    │   Router    │    │   Layer     │    │   Layer     │     │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                   │                   │                   │         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   WebSocket │◀───│ Socket.IO   │◀───│   Service   │◀───│   Database  │     │
│  │   Events    │    │   Server    │    │   Layer     │    │   Changes   │     │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

*These architecture diagrams provide a comprehensive visual representation of the Frigate Middleware API system, showing the relationships between components, data flow, security layers, and deployment architecture.*
